<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pomodoro Timer (Test 25s/5s)</title>
<style>
  body { margin:0; font-family: sans-serif; background:#0b0b0b; color:#fff; display:grid; place-items:center; min-height:100vh; }
  .app { width:300px; background:#181818; border-radius:12px; padding:20px; text-align:center; }
  .time { font-size:48px; margin:20px 0; }
  .btns button { margin:5px; padding:10px 16px; border:none; border-radius:8px; cursor:pointer; }
  .start { background:#2f6df6; color:#fff; }
  .stop { background:#d9534f; color:#fff; }
  .reset { background:#5bc0de; color:#fff; }
  /* オーバーレイは初期状態で非表示 */
  #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85);
             color:white; font-size:2em; align-items:center; justify-content:center; z-index:9999; }
  #cycle { font-size: 14px; color: #9ad; margin-bottom: 14px; }
</style>
</head>
<body>
<div class="app">
  <h1>Pomodoro Timer</h1>
  <div id="cycle">25分集中 🔄 5分休憩</div>
  <div id="mode">モード: 待機</div>
  <div id="time" class="time">00:25</div>
  <div class="btns">
    <button id="startBtn" class="start">スタート</button>
    <button id="stopBtn" class="stop">停止</button>
    <button id="resetBtn" class="reset">リセット</button>
  </div>
</div>

<div id="overlay">🎉 終了！ 🎉</div>

<audio id="bgm" src="sounds/mixkit-recline-and-chill-25.mp3" loop></audio>

<script>
(function(){
  const focusSec = 25, breakSec = 5*60;
  let remain = focusSec, timer=null, running=false, mode='focus';

  const timeEl = document.getElementById('time');
  const modeEl = document.getElementById('mode');
  const overlay = document.getElementById('overlay');

  function fmt(s){ const m=Math.floor(s/60), sec=s%60; return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`; }

  function render(){ timeEl.textContent = fmt(remain); modeEl.textContent = `モード: ${mode==='focus'?'集中':'休憩'}`; }

  function showOverlay(msg){
    overlay.textContent = msg;
    overlay.style.display = "flex";
    setTimeout(()=>{ overlay.style.display="none"; }, 5000);
  }

  function switchMode(){
    if(mode==='focus'){ 
      mode='break'; 
      remain=breakSec; 
      showOverlay("集中終了！休憩しましょう"); 
      const bgm = document.getElementById("bgm");
      bgm.currentTime = 0;   // 毎回頭から再生
      bgm.play();            // 休憩開始と同時に再生
    } else { 
      mode='focus'; 
      remain=focusSec; 
      showOverlay("休憩終了！集中を始めましょう"); 
      const bgm = document.getElementById("bgm");
      bgm.pause(); 
      bgm.currentTime = 0;   // 集中に戻ったら停止＆リセット
    }
    render();
  }

  function tick(){
    if(!running) return;
    remain--; render();
    if(remain<0) switchMode();
  }

  document.getElementById('startBtn').onclick = ()=>{
    if(running) return;
    running=true; render();
    timer=setInterval(tick,1000);
    if(mode === 'break'){
      const bgm = document.getElementById("bgm");
      bgm.play();
    }
  };
  document.getElementById('stopBtn').onclick = ()=>{
    running=false; clearInterval(timer);
    const bgm = document.getElementById("bgm");
    if(mode === 'break'){ bgm.pause(); }   // 休憩中なら音も一時停止
  };
  document.getElementById('resetBtn').onclick = ()=>{
    running=false; clearInterval(timer);
    mode='focus'; remain=focusSec; render();
    // リセット時もオーバーレイは必ず消す
    overlay.style.display="none";
    const bgm = document.getElementById("bgm");
    bgm.pause();          // リセット時も音声を止める
    bgm.currentTime = 0;  // 再生位置をリセット
  };

  render();
})();
</script>
</body>
</html>
